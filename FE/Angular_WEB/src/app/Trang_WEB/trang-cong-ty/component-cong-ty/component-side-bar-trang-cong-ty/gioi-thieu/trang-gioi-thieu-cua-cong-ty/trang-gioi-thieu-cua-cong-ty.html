<div *ngIf="dang_tai" class="tai_loading text-center py-5">
  <div class="spinner-border" role="status">
    <span class="visually-hidden">Đang tải...</span>
  </div>
</div>

<div *ngIf="!dang_tai && cong_ty" class="trang_cong_ty">

  <div class="anh_bia_cong_ty position-relative"
    [style.background-image]="'url(' + layDiaChiHinhAnhBia(cong_ty?.anh_bia) + ')'">
    <div class="lop_phu_anh_bia"></div>

    <button class="btn btn-light btn-sm nut_thay_doi_anh_bia" (click)="chon_anh_bia.click()">
      <i class="bi bi-camera-fill"></i> Thay đổi ảnh bìa
    </button>
    <input type="file" #chon_anh_bia accept="image/*" hidden (change)="khiChonAnhBia($event)">
  </div>

  <div class="container mt-4">
    <div class="tieu_de_cong_ty mb-3">
      <div class="anh_dai_dien_cong_ty d-flex align-items-end gap-4">
        <img class="logo_cong_ty rounded border" style="width: 100px; height: 100px; object-fit: cover;"
          [src]="layDiaChiHinhAnh(cong_ty.logo)" alt="logo" />
        <div class="thong_tin_cong_ty flex-grow-1">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h1 class="ten_cong_ty mb-2">
                <span *ngIf="phan_dang_chinh_sua !== 'name'">{{ cong_ty.ten_cong_ty || 'Tên công ty' }}</span>
                <input *ngIf="phan_dang_chinh_sua === 'name'" [(ngModel)]="cong_ty.ten_cong_ty" class="form-control" />
              </h1>
              <div class="thong_tin_ngan_gon d-flex flex-wrap gap-3 mb-2 text-muted">
                <span><i class="bi bi-briefcase"></i> {{ layLoaiHinhCongTy(cong_ty?.loai_hinh_cong_ty) || 'Ngành nghề'
                  }}</span>
                <span><i class="bi bi-geo-alt"></i> {{ cong_ty.dia_chi || 'Địa điểm' }}</span>
                <span *ngIf="cong_ty.website">
                  <i class="bi bi-globe"></i>
                  <a [href]="cong_ty.website" target="_blank">Website</a>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <nav class="thanh_tab_cong_ty mt-4">
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="nav-link" (click)="tab_dang_hoat_dong='overview'" [class.active]="tab_dang_hoat_dong==='overview'">
            <i class="bi bi-info-circle"></i> Tổng quan
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" (click)="tab_dang_hoat_dong='jobs'" [class.active]="tab_dang_hoat_dong==='jobs'">
            <i class="bi bi-briefcase"></i> Việc làm
            <span class="badge bg-primary ms-1">{{ cong_ty.jobs?.length || 0 }}</span>
          </a>
        </li>
      </ul>
    </nav>

    <div class="noi_dung_tab mt-4 mb-5">

      <div *ngIf="tab_dang_hoat_dong==='overview'" class="hieu_ung_fade">
        <div class="row g-4">
          <div class="col-lg-8">
            <div class="the_noi_dung mb-4">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h4 class="tieu_de_muc"><i class="bi bi-info-circle-fill text-primary"></i> Giới thiệu công ty</h4>
                <button *ngIf="la_chu_cong_ty && phan_dang_chinh_sua !== 'description'"
                  class="btn btn-sm btn-outline-primary" (click)="batCheDoChinhSua('description')">
                  <i class="bi bi-pencil"></i> Sửa
                </button>
              </div>

              <div *ngIf="phan_dang_chinh_sua === 'description'">
                <textarea [(ngModel)]="cong_ty.mo_ta" rows="5" class="form-control mb-2"></textarea>
                <div class="d-flex gap-2">
                  <button class="btn btn-sm btn-success"
                    (click)="luuChinhSuaGioiThieuCongTy(cong_ty.ma_cong_ty)">Lưu</button>
                  <button class="btn btn-sm btn-secondary" (click)="huyChinhSua()">Hủy</button>
                </div>
              </div>

              <p *ngIf="phan_dang_chinh_sua !== 'description'"
                [innerHTML]="cong_ty.mo_ta || 'Chưa có thông tin giới thiệu.'">
              </p>

              <div class="the_noi_dung">
                <h4 class="tieu_de_muc"><i class="bi bi-star-fill text-warning"></i> Việc làm nổi bật</h4>
                <div *ngIf="danh_sach_viec_lam_noi_bat_cua_cong_ty?.length; else khong_noi_bat">
                  <div *ngFor="let viec of danh_sach_viec_lam_noi_bat_cua_cong_ty" class="the_viec_lam mb-3"
                    (click)="moViecLam(viec.viec_Lam)">
                    <div class="d-flex justify-content-between align-items-start">

                      <div class="flex-grow-1">
                        <h5 class="tieu_de_viec mb-2 text-primary">
                          {{ viec.viec_Lam.tieu_de || viec.viec_Lam.nganh_nghe }}
                        </h5>

                        <div class="meta_viec text-muted small mb-2 d-flex flex-wrap gap-2">
                          <span class="me-2"><i class="bi bi-geo-alt"></i> {{ viec.viec_Lam.vi_tri || 'Không xác định'
                            }}</span>
                          <span class="me-2 text-danger" *ngIf="viec.viec_Lam.muc_luong"><i
                              class="bi bi-currency-dollar"></i> {{
                            viec.viec_Lam.muc_luong }}</span>
                          <span class="me-2" *ngIf="viec.viec_Lam.loai_hinh"><i class="bi bi-clock"></i> {{
                            layLoaiHinhViecLam(viec.viec_Lam.loai_hinh) }}</span>
                        </div>

                        <p class="mo_ta_viec mb-1 text-secondary">{{ viec.viec_Lam.mo_ta || 'Chưa có mô tả' }}</p>
                      </div>

                      <div class="text-end ms-3">
                        <small class="ngay_dang text-muted">{{ viec.viec_Lam.ngay_tao | date:'dd/MM/yyyy' }}</small>
                      </div>

                    </div>
                  </div>
                </div>
                <ng-template #khong_noi_bat>
                  <div class="trang_thai_rong text-center py-4"><i class="bi bi-inbox"></i>
                    <p>Không có việc làm nổi bật</p>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <aside class="col-lg-4">
            <div class="the_thong_tin mb-4">
              <h5 class="tieu_de_the mb-3">Thông tin công ty</h5>
              <div class="danh_sach_thong_tin">
                <div class="dong_thong_tin" *ngIf="cong_ty.quy_mo">
                  <i class="bi bi-building"></i>
                  <div><small class="text-muted">Quy mô</small>
                    <p class="mb-0">{{ cong_ty.quy_mo }}</p>
                  </div>
                </div>
                <div class="dong_thong_tin" *ngIf="cong_ty.nam_thanh_lap">
                  <i class="bi bi-calendar-event"></i>
                  <div><small class="text-muted">Năm thành lập</small>
                    <p class="mb-0">{{ cong_ty.nam_thanh_lap }}</p>
                  </div>
                </div>
                <div class="dong_thong_tin" *ngIf="cong_ty.ma_so_thue">
                  <i class="bi bi-hash"></i>
                  <div><small class="text-muted">Mã số thuế</small>
                    <p class="mb-0">{{ cong_ty.ma_so_thue }}</p>
                  </div>
                </div>
                <div class="dong_thong_tin" *ngIf="cong_ty.dia_chi">
                  <i class="bi bi-geo-alt-fill"></i>
                  <div><small class="text-muted">Địa chỉ</small>
                    <p class="mb-0">{{ cong_ty.dia_chi }}</p>
                  </div>
                </div>
                <div class="dong_thong_tin" *ngIf="cong_ty.email">
                  <i class="bi bi-envelope"></i>
                  <div><small class="text-muted">Email</small>
                    <p class="mb-0"><a [href]="'mailto:' + cong_ty.email">{{ cong_ty.email }}</a></p>
                  </div>
                </div>
                <div class="dong_thong_tin" *ngIf="cong_ty.dien_thoai">
                  <i class="bi bi-telephone"></i>
                  <div><small class="text-muted">Điện thoại</small>
                    <p class="mb-0"><a [href]="'tel:' + cong_ty.dien_thoai">{{ cong_ty.dien_thoai }}</a></p>
                  </div>
                </div>
              </div>
            </div>

            <div class="the_phuc_loi mb-4">
              <h5 class="tieu_de_the mb-3 d-flex justify-content-between align-items-center">
                <span><i class="bi bi-gift-fill text-success"></i> Phúc lợi</span>
                <button *ngIf="la_chu_cong_ty && phan_dang_chinh_sua !== 'benefits'"
                  class="btn btn-sm btn-outline-primary" (click)="batCheDoChinhSua('benefits')">
                  <i class="bi bi-pencil"></i> Sửa
                </button>
              </h5>

              <ul *ngIf="phan_dang_chinh_sua !== 'benefits'">
                <li *ngFor="let b of cong_ty?.phuc_loi_cong_ty">{{ b.ten_phuc_loi || 'Chưa có tên phúc lợi' }}</li>
              </ul>

              <div *ngIf="phan_dang_chinh_sua === 'benefits'">
                <div *ngIf="cong_ty.phuc_loi_cong_ty">
                  <div *ngFor="let b of cong_ty.phuc_loi_cong_ty; let i = index">
                    <input [(ngModel)]="cong_ty.phuc_loi_cong_ty[i].ten_phuc_loi" placeholder="Tên phúc lợi"
                      class="form-control" />
                    <input [(ngModel)]="cong_ty.phuc_loi_cong_ty[i].mo_ta" placeholder="Mô tả" class="form-control" />
                    <button class="btn btn-sm btn-danger"
                      (click)="xoaPhucLoi(cong_ty.ma_cong_ty, i, cong_ty.phuc_loi_cong_ty[0].ma_phuc_loi_cty)">Xóa</button>
                  </div>
                </div>

                <button class="btn btn-sm btn-primary mb-2" (click)="themPhucLoi()">Thêm phúc lợi</button>
                <div class="d-flex gap-2">
                  <button class="btn btn-sm btn-success" (click)="luuChinhSuaPhucLoi(cong_ty.ma_cong_ty)">Lưu</button>
                  <button class="btn btn-sm btn-secondary" (click)="huyChinhSua()">Hủy</button>
                </div>
              </div>
            </div>

            <div class="the_mang_xa_hoi">
              <h5 class="tieu_de_the mb-3 d-flex justify-content-between align-items-center">
                <span>Mạng xã hội & Liên hệ</span>
                <button *ngIf="la_chu_cong_ty && phan_dang_chinh_sua !== 'social'"
                  class="btn btn-sm btn-outline-primary" (click)="batCheDoChinhSua('social')">
                  <i class="bi bi-pencil"></i> Sửa
                </button>
              </h5>

              <div *ngIf="phan_dang_chinh_sua !== 'social'" class="d-flex gap-3 flex-wrap align-items-center">
                <ng-container *ngFor="let s of cong_ty?.lien_ket_mang_xa_hoi">
                  <a *ngIf="s.ten_mang_xa_hoi && s.duong_dan" [href]="s.duong_dan" target="_blank" class="icon-mxh"
                    [title]="s.ten_mang_xa_hoi" [innerHTML]="layBieuTuong(s.ten_mang_xa_hoi)">
                  </a>
                </ng-container>
              </div>

              <div *ngIf="phan_dang_chinh_sua === 'social'">
                <div *ngFor="let s of danh_sach_mang_xa_hoi; let i = index"
                  class="mb-2 d-flex gap-2 align-items-center">
                  <i *ngIf="s.ten" class="bi fs-4" [ngClass]="ban_do_bieu_tuong_mang_xa_hoi[s.ten] || 'bi-globe'"></i>
                  <input [(ngModel)]="s.lien_ket" class="form-control" [placeholder]="'Nhập đường dẫn ' + s.ten" />
                </div>

                <div class="d-flex gap-2 mt-2">
                  <button class="btn btn-sm btn-success" (click)="luuLienKetMangXaHoi()">Lưu</button>
                  <button class="btn btn-sm btn-secondary" (click)="huyChinhSua()">Hủy</button>
                </div>
              </div>

            </div>

          </aside>
        </div>
      </div>

      <div *ngIf="tab_dang_hoat_dong==='jobs'" class="hieu_ung_fade">
        <div class="the_noi_dung">
          <div *ngIf="cong_ty?.jobs?.length; else khong_co_viec">
            <div *ngFor="let viec of cong_ty.jobs" class="the_viec_lam p-3 border rounded mb-3 shadow-sm"
              (click)="moViecLam(viec)">
              <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                  <h5 class="tieu_de_viec mb-2 text-primary">{{ viec.tieu_de || viec.nganh_nghe }}</h5>
                  <div class="meta_viec text-muted small mb-2">
                    <span class="me-3"><i class="bi bi-geo-alt"></i> {{ viec.vi_tri || 'Không xác định' }}</span>
                    <span class="me-3" *ngIf="viec.muc_luong"><i class="bi bi-currency-dollar"></i> {{
                      viec.muc_luong }}</span>
                    <span class="me-3" *ngIf="viec.loai_hinh"><i class="bi bi-clock"></i> {{
                      layLoaiHinhViecLam(viec.loai_hinh) }}</span>
                  </div>
                  <p class="mo_ta_viec mb-1 text-secondary">{{ viec.mo_ta || 'Chưa có mô tả' }}</p>
                </div>
                <span class="ngay_dang small text-muted">{{ viec.ngay_tao | date:'dd/MM/yyyy' }}</span>
              </div>
            </div>
          </div>

          <ng-template #khong_co_viec>
            <div class="text-center py-5 text-muted">
              <i class="bi bi-inbox fs-2 d-block mb-2"></i>
              <p>Hiện tại công ty chưa đăng việc làm nào.</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>