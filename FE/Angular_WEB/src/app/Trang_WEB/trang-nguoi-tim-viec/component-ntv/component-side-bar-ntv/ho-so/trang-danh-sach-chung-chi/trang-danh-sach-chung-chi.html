<div class="page-wrapper">
  <h3 class="mb-3 text-center">Danh sách chứng chỉ của tôi</h3>
  <div class="popup-overlay" *ngIf="hienPopup">
    <div class="popup-card">
      <h3 *ngIf="buoc === 1">Nhập thông tin chứng chỉ</h3>
      <h3 *ngIf="buoc === 2">Tải lên file chứng chỉ (PDF)</h3>

      <form *ngIf="buoc === 1" #f="ngForm" (ngSubmit)="chuyenSangBuoc2(f)">
        <div class="form-group">
          <label>Tên chứng chỉ <span class="required">*</span></label>
          <input type="text" name="ten_chung_chi" [(ngModel)]="chungChi.ten_chung_chi" required />
        </div>

        <div class="form-group">
          <label>Đơn vị cấp</label>
          <input type="text" name="don_vi_cap" [(ngModel)]="chungChi.don_vi_cap" />
        </div>

        <div class="form-group">
          <label>Ngày cấp</label>
          <input type="date" name="ngay_cap" [(ngModel)]="chungChi.ngay_cap" />
        </div>

        <div class="form-group">
          <label>Ngày hết hạn</label>
          <input type="date" name="ngay_het_han" [(ngModel)]="chungChi.ngay_het_han" />
        </div>

        <div class="btn-row">
          <button type="button" class="btn-cancel" (click)="dongPopup()">Hủy</button>
          <button type="submit" class="btn-next">Tiếp tục</button>
        </div>
      </form>

      <div *ngIf="buoc === 2" class="upload-card">
        <label class="file-input">
          <span>Chọn file PDF</span>
          <input type="file" accept="application/pdf" (change)="chonFile($event)" hidden />
        </label>

        <div *ngIf="tepPDF" class="file-info">
          <p><strong>Tên file:</strong> {{ tepPDF.name }}</p>
          <p><strong>Kích thước:</strong> {{ (tepPDF.size / 1024).toFixed(1) }} KB</p>
        </div>

        <div class="btn-row">
          <button class="btn-back" (click)="quayLai()">Quay lại</button>
          <button class="btn-upload" [disabled]="!tepPDF" (click)="taiLen()">Tải lên</button>
        </div>
      </div>
    </div>
  </div>
  <div class="container py-3">
  <div class="card shadow-sm p-4 rounded-3">
    

    <button class="btn-add" (click)="moPopup()">+ Thêm chứng chỉ</button>

    <div *ngIf="loading" class="text-center mt-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Đang tải...</span>
      </div>
      <p class="mt-2 text-muted">Đang tải dữ liệu...</p>
    </div>

    <div *ngIf="danh_sach_chung_chi.length > 0" class="mt-4">
      <div class="list-group">
        <div class="list-group-item list-group-item-action py-3 mb-3 border shadow-sm"
             *ngFor="let chungChi of danh_sach_chung_chi; let i = index">
          
          <div class="d-flex align-items-start">
            <div class="flex-grow-1">
              <h5 class="mb-1 text-primary fw-semibold">{{ chungChi.ten_chung_chi }}</h5>
              <p class="mb-1"><b>Đơn vị cấp:</b> {{ chungChi.don_vi_cap }}</p>
              <p class="mb-1"><b>Ngày cấp:</b> {{ chungChi.ngay_cap | date:'dd/MM/yyyy' }}</p>
              <p class="mb-1"><b>Ngày hết hạn:</b> {{ chungChi.ngay_het_han | date:'dd/MM/yyyy' }}</p>
              <p class="mt-2 text-secondary small">
                <a *ngIf="chungChi.duong_dan_file" [href]="xemFile(chungChi.duong_dan_file)" target="_blank">
                   Xem tệp PDF
                </a>
                <span *ngIf="!chungChi.duong_dan_file" class="text-muted">Chưa có tệp đính kèm</span>
              </p>
            </div>

            <div class="dropdown ms-3">
              <button class="btn btn-light btn-sm rounded-circle border-0" data-bs-toggle="dropdown"
                      aria-expanded="false">
                <h3 style="font-weight: bold;">⋮</h3>
              </button>
              <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                <li>
                  <a class="dropdown-item text-danger" (click)="xoaChungChi(chungChi, i)">
                    <i class="bi bi-trash me-2"></i> Xóa chứng chỉ
                  </a>
                </li>
              </ul>
            </div>
          </div>
          
        </div>
      </div>
    </div>

    <div *ngIf="danh_sach_chung_chi.length === 0" class="text-center text-muted mt-4">
      Chưa có chứng chỉ nào được tải lên.
    </div>

    <div *ngIf="error" class="text-center text-danger mt-3">
      {{ error }}
    </div>
  </div>
</div>

</div>
